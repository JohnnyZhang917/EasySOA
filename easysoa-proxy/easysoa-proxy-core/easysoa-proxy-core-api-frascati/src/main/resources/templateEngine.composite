<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sca:composite xmlns:sca="http://www.osoa.org/xmlns/sca/1.0" 
               xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
               xmlns:frascati="http://frascati.ow2.org/xmlns/sca/1.1" 
               xmlns:web="http://frascati.ow2.org/xmlns/web/1.0" 
               xmlns:tuscany="http://tuscany.apache.org/xmlns/sca/1.0"
               name="templateEngine">

	<sca:service name="templateEngineServiceRef" promote="templateEngineComponent/templateEngineService"/>

	<!-- Template engine -->
	<sca:component name="templateEngineComponent">
		<sca:service name="templateEngineService">
			<sca:interface.java interface="org.easysoa.proxy.core.api.template.TemplateEngine" />
		</sca:service>
		<sca:implementation.java class="org.easysoa.proxy.core.api.template.TemplateEngineImpl" />
		<sca:reference name="templateRenderer" target="TemplateProcessor/processor" />
	</sca:component>

	<!--  Template processor -->
	<sca:service name="processor" promote="TemplateProcessor/processor"/>

	<!-- Component for proxy implementation Velocity -->
	<sca:component name="TemplateProcessor">
		<sca:implementation.java class="org.easysoa.proxy.core.api.template.TemplateRenderer" />
		<sca:service name="processor">
			<sca:interface.java interface="org.easysoa.proxy.core.api.template.TemplateProcessorRendererItf" />
		</sca:service>
		<sca:reference name="template">
			<sca:interface.java interface="org.easysoa.proxy.core.api.template.TemplateRendererItf" />
		</sca:reference>
	</sca:component>
        
        <sca:component name="TemplateReplayHttpController">
		<!-- web:implementation.velocity xmlns="http://frascati.ow2.org/xmlns/web/1.0" location="webContent/templates" default="templateReplayHttpController.vm" / -->
                <sca:implementation.java class="org.easysoa.proxy.core.api.template.ReplayHttpControllerServlet"/>
		<sca:service name="servlet">
			<sca:interface.java interface="javax.servlet.Servlet"/>
                        <tuscany:binding.http xmlns="http://tuscany.apache.org/xmlns/sca/1.0" uri="/target"/>
		</sca:service>
		<sca:reference name="templateReplayWSDLHTMLListRenderer">
			<sca:interface.java interface="javax.servlet.Servlet" /><!-- TODO wire & provide additional params through attributes http://appfuse.547863.n4.nabble.com/Acces-request-attribute-in-velocity-template-td1013481.html -->
		</sca:reference>
		<sca:reference name="templateReplayWSDLRenderer">
			<sca:interface.java interface="javax.servlet.Servlet" /><!-- TODO wire & provide additional params through attributes http://appfuse.547863.n4.nabble.com/Acces-request-attribute-in-velocity-template-td1013481.html -->
		</sca:reference>
		<sca:reference name="wsdlDataStoreProvider">
			<sca:interface.java interface="org.easysoa.proxy.core.api.template.WsdlDataStoreProvider" />
		</sca:reference>
		<!-- sca:reference name="templateReplayWSDLHTMLList">
			<sca:interface.java interface="org.easysoa.proxy.core.api.template.TemplateRendererItf" />
		</sca:reference -->
		<!-- sca:reference name="(velocity...) renderers for HTML WSDL list, WSDL file, request replay">
			<sca:interface.java interface="org.easysoa.proxy.core.api.template.TemplateRendererItf" />
		</sca:reference -->
	</sca:component>

        <sca:wire source="TemplateReplayHttpController/templateReplayWSDLHTMLListRenderer" target="templateEngineComponentRef/servlet"/>

	<sca:component name="templateEngineComponentRef">
		<web:implementation.velocity xmlns="http://frascati.ow2.org/xmlns/web/1.0" location="webContent/templates" default="storeListTemplate.html" />
		<sca:service name="servlet">
			<sca:interface.java interface="javax.servlet.Servlet" />
		</sca:service>
	</sca:component>

        <sca:wire source="TemplateReplayHttpController/templateReplayWSDLRenderer" target="TemplateReplayWSDLRenderer/template"/>

	<sca:component name="TemplateReplayWSDLRenderer">
		<web:implementation.velocity xmlns="http://frascati.ow2.org/xmlns/web/1.0" location="webContent/templates" default="wsdlTemplate.xml" />
		<sca:service name="template">
			<sca:interface.java interface="javax.servlet.Servlet" />
		</sca:service>
	</sca:component>

        <sca:wire source="TemplateReplayHttpController/wsdlDataStoreProvider" target="WsdlDataStoreProvider/provider"/>

	<sca:component name="WsdlDataStoreProvider">
		<sca:implementation.java class="org.easysoa.proxy.core.api.template.WsdlDataStoreProviderImpl" />
		<sca:service name="provider">
			<sca:interface.java interface="org.easysoa.proxy.core.api.template.WsdlDataStoreProvider" />
		</sca:service>
	</sca:component>        
                        
        <!-- TODO LATER handle the ProxyVelocity hack to be able to remove it -->
	<sca:component name="ProxyWSTemplate">
		<web:implementation.velocity xmlns="http://frascati.ow2.org/xmlns/web/1.0" location="webContent/templates" default="template.vm" />
		<sca:service name="template">
			<sca:interface.java interface="org.easysoa.proxy.core.api.template.TemplateRendererItf" />
		</sca:service>
		<sca:property name="pathArgIndex">0</sca:property> <!--type="xsd:int"-->
		<sca:property name="storeIndex">1</sca:property> <!--type="xsd:int"-->
	</sca:component>
        
	<sca:wire source="TemplateProcessor/template" target="ProxyWSTemplate/template" />

</sca:composite>