<f:subview
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  id="#{layout.id}">
  
  <!-- EasySOA: Template based on layout_default_template.xhtml,
  	which allows for an adapted view according to the user profile. -->


  <c:set var="isEditMode" value="#{nxl:isBoundToEditMode(layout.mode)}" />

  <!-- EasySOA: Fetch user group -->
  <c:set var="userGroup" value="#{userManager.getUserModel(threadEntry.comment.comment.author).getProperty('user', 'groups')}" />

  <c:choose>
	  <c:when test="#{layout.properties['title'] == null 
	|| (layout.name.contains('spec') and (userGroup.equals('Developer') or userGroup.equals('Architect')) 
	|| (layout.name.contains('tech') and userGroup.equals('IT Staff')))}">
	  	  <!-- Layout title -->
		  <c:if test="#{!empty layout.properties['title']}">
		    <h3>
		      <h:outputText value="#{layout.properties['title']}" />
		    </h3>
		  </c:if>
		  
		 <ui:include src="layout_easysoa_fields_template.xhtml" />
	  </c:when>
	  <c:otherwise>

		<div class="foldableLightBox">

		      <div class="foldableLightBoxHeader folded" style="margin-top: 8px">
			<a href="#nologo" onclick="return toggleBox(this)" style="font-size: 10pt">
			  <h:outputText value="#{layout.properties['title']}"/>
			</a>
		      </div>
		    <div class="boxBody" style="#{nxu:test(openBox, '', 'overflow: visible; display: none;')}">
			 <ui:include src="layout_easysoa_fields_template.xhtml" />
		    </div>

		</div>

	  </c:otherwise>
  </c:choose>

<script>
  jQuery(document).ready(function() {
    jQuery("img.layoutHelpLabel[title]").tooltip({delay:1000, predelay:250, offset: [0, 100], position: 'center center'});
  });
</script>

</f:subview>
