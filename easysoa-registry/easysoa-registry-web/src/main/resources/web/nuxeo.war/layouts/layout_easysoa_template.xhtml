<f:subview
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  id="#{layout.id}">
  
  <!-- EasySOA: Template based on layout_default_template.xhtml,
  	which allows for an adapted view according to the user profile. -->

  <c:set var="isEditMode" value="#{nxl:isBoundToEditMode(layout.mode)}" />

  <c:choose>
  
 	  <!--  Standard schema -->
	  <c:when test="#{layout.properties['title'] == null}">
		 <ui:include src="layout_easysoa_fields_template.xhtml" />
	  </c:when>
	  
 	  <!--  Foldable schema (by default folded or unfolded according to the user group) -->
	  <c:otherwise>
 		<c:set var="userGroup" value="#{userManager.getUserModel(messages['label.loggedAsUser']).getProperty('user', 'groups')}" />
 		<c:set var="foldingStatus" value="${(layout.properties['groups'] != null) and (layout.properties['groups'].contains(userGroup[0]))}" />
		<div class="foldableLightBox">
		      <div class="foldableLightBoxHeader ${((foldingStatus) ? 'unfolded' : 'folded')}" style="margin-top: 8px">
			<a href="#nologo" onclick="return toggleBox(this)" style="font-size: 10pt">
			  <h:outputText value="#{layout.properties['title']}"/>
			</a>
		      </div>
		    <div class="boxBody" style="#{nxu:test(foldingStatus, '', 'overflow: visible; display: none;')}">
			 <ui:include src="layout_easysoa_fields_template.xhtml" />
		    </div>
		</div>

	  </c:otherwise>
  </c:choose>

<script>
  jQuery(document).ready(function() {
    jQuery("img.layoutHelpLabel[title]").tooltip({delay:1000, predelay:250, offset: [0, 100], position: 'center center'});
  });
</script>

</f:subview>